{
  "hash": "12ebcb1630841cca53bd0e84285ef00a",
  "result": {
    "markdown": "---\ntitle: \"Lecture 15: Bayesian Multiple Testing\"\nauthor: \"Merlise Clyde\"\nsubtitle: \"STA702\"\ninstitute: \"Duke University\"\nformat: \n  revealjs:\n    theme: [simple, custom.scss]\n    slide-number: true\n    incremental: true\n    scrollable: false\n    controls: true\n    fragments: true\n    preview-links: auto\n    smaller: true\n    logo: ../../img/icon.png\n    footer: <https://sta702-F23.github.io/website/>\n    chalkboard: \n      boardmarker-width: 1\n      chalk-width: 2\n      chalk-effect: 0\n    embed-resources: false\nhtml-math-method:\n  method: mathjax\n  url: \"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"    \neditor: \n  markdown: \n    wrap: 72\nexecute: \n  echo: false\nnumber-sections: false\nfilters:\n  - custom-numbered-blocks  \ncustom-numbered-blocks:\n  groups:\n    thmlike:\n      colors: [948bde, 584eab]\n      boxstyle: foldbox.simple\n      collapse: false\n      listin: [mathstuff]\n    todos: default  \n  classes:\n    Theorem:\n      group: thmlike\n    Corollary:\n      group: thmlike\n    Conjecture:\n      group: thmlike\n      collapse: true  \n    Definition:\n      group: thmlike\n      colors: [d999d3, a01793]\n    Feature: default\n    TODO:\n      label: \"To do\"\n      colors: [e7b1b4, 8c3236]\n      group: todos\n      listin: [stilltodo]\n    DONE:\n      label: \"Done\"\n      colors: [cce7b1, 86b754]  \n      group: todos  \n---\n\n\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n\n\n\n## Normal Means Model\n\nSuppose we have normal data with \n$$Y_i \\mid \\mu_i, \\sigma^2 \\overset{iid}{\\sim} \\textsf(\\mu_i, \\sigma^2)$$\n\n- $H_{0i}: \\mu_i = 0$ versus $H_{1i}: \\mu_i \\neq 0$ \n\n  \n\n- Spike & Slab Prior:\n\n $$\\mu_i \\overset{iid}{\\sim} \\pi_0 \\delta_0 + (1 - \\pi_0)g(\\mu_i \\mid 0,  \\tau, H_{i1})$$ \n\n  \n\n-  need to specify \n\n  - $\\pi_0$\n  - $g$\n  \n  \n\n- concern: is that # errors blows up with $n$ \n($n$ = # tests = dimension of $\\{\\mu_i\\}$ )\n\n  \n\n\n \n## Approach 1: Prespecify $\\pi_0$\n\n$\\pi_0 = \\Pr(H_{0i})$ \n\n  \n\n- seemingly non-informative choice?  \n\n  \n\n$$\\pi_0 = 0.5$$\n\n  \n\n- What does imply about the \"model size\" prior?  The number of times $H_{1i}$ is true?\n\n  \n\n- Let \n\n$$\\gamma_i = \\left\\{ \\begin{array}{c} 1 \\text{ if }  H_{1i} \\text{ is true } \\\\\n0 \\text{ if }  H_{0i} \\text{ is true } \\end{array} \\right.$$\n\n  \n\n$$\\gamma^{(n)} = (\\gamma_1, \\gamma_2, \\ldots, \\gamma_n)^2$$\n\n- e.g. $\\gamma^{(n)} = (0,1,0,0, \\ldots, 1)^T$\n\n  \n\n- model size $p_\\gamma  = \\sum_{i = 1}^n \\gamma$ is the number of non-zero values\n\n  \n\n-  Distribution of $p_\\gamma$?\n\n \n##  Induced Distribution\n\n$$p_\\gamma \\sim \\textsf{Binomial(n, 1/2)}$$\n  \n\n- Expected 1/2 of the hypotheses to be true a priori\n\n  \n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](15-Bayes-multiple-testing_files/figure-revealjs/unnamed-chunk-2-1.png){fig-align='center' width=50%}\n:::\n:::\n\n\n \n## Probabities of no or at least 1 signal\n\n$$p_\\gamma \\sim \\textsf{Binomial(n, 1/2)}$$\n\n- probability of observing no signals $\\gamma^{(n)} = (0,0,0,\\ldots, 0)^T$ or $p_\\gamma = 0$\n\n$$\\Pr(p_\\gamma = 0) = \\pi_0^n = 0.5^n$$\n  \n\n- approximately $0$ for large $n$\n\n  \n\n-  probability of at least one signal is  $1 - 0.5^n \\approx 1$\n\n \n## Control  Type I Errors\n\n- Suppose we want to fix $\\pi_0$ that protexts against Type I errors blowing up as $n$ increases\n\n  \n\n$$\\Pr( p_\\gamma = \\mathbf{0}_n) =  \\frac{1}{2} = \\pi_0^n$$\n  \n\n- \"Bayesian Bonferroni Prior\" \n\n  \n\n- so $\\pi_0 = 0.5^{1/n}$  very close to 1 !   Need overwhelming evidence in the data for $\\Pr(H_{1i} \\mid y^{(n)})$ to not be $\\approx 0$!\n\n  \n\n- not a great idea to prespecify $\\pi_0$!\n\n \n## Approach 2: Empirical Bayes\n\n- We could try to maximize the marginal likelihood  \n\n  \n\n$$Y_i \\mid \\mu_i, \\sigma^2 \\overset{ind}{\\sim} \\textsf{N}(\\mu_i, \\sigma^2)$$\n\n\n $$\\mu_i \\overset{iid}{\\sim} \\pi_0 \\delta_0 + (1 - \\pi_0)\\textsf{N}(\\mu_i; 0,  \\tau)$$ \n \n  \n\n$$\\begin{align*} \\cal{L}(\\pi_0, \\tau) & =  \\int_{\\mathbb{R}^n} \\prod_{i = 1}^n  \\textsf{N}(y_i ; \\mu_i, \\sigma^2) \\left\\{\\pi_0 \\delta_0(\\mu_i) + (1 - \\pi_0)\\textsf{N}(\\mu_i; 0,  \\tau) \\right\\} d\\mu_1 \\ldots d\\mu_n\n\\\\\n& =  \\prod_{i = 1}^n  \\int_\\mathbb{R}  \\textsf{N}(y_i ; \\mu_i, \\sigma^2) \\left\\{\\pi_0 \\delta_0(\\mu_i) + (1 - \\pi_0)\\textsf{N}(\\mu_i; 0,  \\tau) \\right\\} d\\mu_i\n\\end{align*}$$\n\n  \n\n- Conjugate or nice setups we can integrate out $\\mu_i$ and then maximize marginal likelihood for $\\pi_0$ and $\\tau$\n\n  \n\n- Numerical integration or EM algorithms to get $\\hat{\\pi}_0^{\\textsf{EB}}$ and $\\hat{\\tau}^{\\textsf{EB}}$\n\n- Clyde & George (2000)  Silverman & Johnstone (2004) for wavelet regression\n \n## Expectation-Maximization\n\n- introduce latent variables so that \"complete\" data likelihood is nice!  e.g. $\\gamma$:\n\n$$ y_i \\mid \\gamma_i, \\tau \\overset{ind}{\\sim} \\textsf{N}(0, 1)^{1 - \\gamma_i} \\textsf{N}(0, 1 + \\tau)^{\\gamma_i}$$\n$$\\gamma_i \\overset{iid}{\\sim} \\textsf{Ber}(1 - \\pi_0)$$\n\n  \n\n- Iterate: For $t = 1, \\ldots$\n\n  \n -  M-step:  Solve for $(\\hat{\\pi}_0^{(t)}, \\hat{\\tau}^{(t)}) = \\arg \\max\\cal{L}(\\pi_0, \\tau \\mid \\hat{\\gamma}^{(t-1)})$\n  \n  \n -  E-step:  find the expected values of the latent sufficient statistics given the data, $\\hat{\\pi}_0^{(t)}$ , $\\hat{\\tau}^{(t)}$\n \n $$\\hat{\\gamma}^{(t)} = \\textsf{E} [\\gamma_i \\mid y, \\hat{\\pi}^{(t)}_0, \\hat{\\tau}^{(t)}]$$\n  \n \n   \n\n\n\n \n## Adding Noise\n\n\nWhat happens to $\\hat{\\pi}_0^{\\textsf{EB}}$ as we add more and more noise to a fixed number of signals?\n\n  \n\n- $\\hat{\\pi}_0^{\\textsf{EB}}$ becomes closer to one as $n \\to \\infty$ for a fixed number of  true signals\n\n  \n\n- This is good as it protects against Type I errors blowing up as $n$ increases!\n\n  \n\n- However it becomes more and more difficult to find the few needles in a haystack!\n\n\n \n## Approach 3:  Fully Bayes\n\nChoose a prior for $\\pi_0$:\n$\\pi_0 \\sim \\textsf{Beta}(a,b)$\n\n  \n\nConsider the thought experiment ...\n\n$$\\gamma^{(n)} = (?, 0,,\\ldots, 0)^T$$\n\nwhere we don't know the first hypothesis but we know that the others  are all null  $\\gamma_j = 0$ for $j = 2, \\ldots, n$\n\n  \n\n- $\\gamma_i \\sim \\textsf{Bernoulli}(1 - \\pi_0)$\n\n  \n\n- Update the prior for $\\pi_0$ to include the info  $\\gamma_j = 0$ for $j = 2, \\ldots, n$\n\n$$\\pi(\\pi_0 \\mid \\gamma_2, \\ldots, \\gamma_n) \\propto \\pi_0^{a - 1} (1 - \\pi_0)^{b -1} \\prod_{j = 2}^n \\pi_0^{1 - \\gamma_j} (1 - \\pi_0)^{\\gamma_j}$$\n\n$$\\pi(\\pi_0  \\mid \\gamma_2, \\ldots, \\gamma_n) \\propto \\pi_0^{a + n -1  -1} (1 - \\pi_0)^{b - 1}$$\n \n## Beta Posterior\n\n$$\\pi_0 \\mid \\gamma_2, \\ldots, \\gamma_n \\sim \\textsf{Beta(a + n - 1, b)}$$\nwith mean \n$$\\textsf{E}[\\pi_0 \\mid \\gamma_2, \\ldots, \\gamma_n] = \\frac{a + n - 1}{a + n - 1 + b}$$\n  \n\n- suppose $a = b = 1$   (Uniform prior)\n\n  \n \n $$\\textsf{E}[\\pi_0 \\mid \\gamma_2, \\ldots, \\gamma_n] = \\frac{n}{n + 1}$$\n \n  \n \n- implies probability of $H_{01} \\to 1$ and  $H_{11} \\to 0$ as $n \\to \\infty$  borrowing strength from other nulls\n\n  \n\n- Multiplicity adjustment as in the EB case\n\n  \n\n- Scott & Berger (2006 JSPI, 2010 AoS) show that above framework protects against increasing Type I errors with $n$; We also get FDR control automatically\n\n \n## Induced Prior on $p_{\\gamma}$\n\nExercise:   If $p_{\\gamma} \\mid \\pi_0 \\sim \\textsf{Binomial}(n, 1 - \\pi_0)$ and $\\pi_0 \\sim \\textsf{Beta}(1,1)$\n\n   \n\n\n- What is the probability that $p_\\gamma = 0$\n\n  \n\n- What is the probability  that $p_\\gamma = n$\n \n  \n\n- What is the distribution of $p_\\gamma$ ?    \n \n \n \n This is a Beta-Binomial and in the special case  $a = b = 1$ this is a discrete uniform on model size!\n \n \n \n  \n \n\nBottomline:  We need to  \"learn\" key parameters  in our hierarchical prior or the magic doesn't work!   Borrowing comes through using all the data to inform about \"global\" parameters in the prior, in this case $\\pi_0$\n\n \n \n##  Posteriors, Inference and Decisions\n\n- Joint posterir distribution of $\\mu_1, \\ldots, \\mu_n$ averaged over hypotheses  \"Model averaging\"\n\n  \n\n - distribution is a spike at 0 and continous distribution\n\n  \n\n- select a hypothesis\n\n  \n\n- report posterior (summaries)  conditional on a hypothesis  \n\n  \n\n- issue **winner's curse** !  \n\n- need to have coherent conditional inference given that you selected a hypothesis.   \n \n  \n\n- Don't report selected hypotheses but report results under model averaging! \n\n \n## Choice of $g$\n\n\n$$\\mu_i \\overset{iid}{\\sim} \\pi_0 \\delta_0 + (1 - \\pi_0)g(\\mu_i \\mid 0,  \\tau, H_{i1})$$ \n  \n\n- growing literature on posterior contraction in high dimensional settings as $n \\to \\infty$ with \"sparse signals\"\n\n  \n\n- posterior $\\pi(\\mu^{(n)}) \\mid y^{(n)})$\n\n  \n\nWant \n$$\\Pr(\\mu^{(n)} \\in \\cal{N}_{\\epsilon_n}(\\mu_0^{(n)}) \\mid y^{(n)})\\to 1$$\n\n  \n\n- assume that there are $s$ signals (fixed or growing slowly)\n\n  \n\n- signal values are bounded away from zero\n\n  \n\n- Want the posterior under the Spike and Slab prior to concentrate on this neighborhood (ie. probability 1 )\n\n  \n\n- active area of research!  \n\n\n",
    "supporting": [
      "15-Bayes-multiple-testing_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/font-awesome/css/all.min.css\" rel=\"stylesheet\" />\n<link href=\"../../site_libs/font-awesome/css/v4-shims.min.css\" rel=\"stylesheet\" />\n"
      ],
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}